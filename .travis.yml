jobs:
  include:
  - os: linux
    dist: bionic
    language: python
    python: 3.8
    addons:
      apt:
        packages:
        - libgfortran5
  - os: linux
    dist: xenial
    language: python
    python: 3.6
    addons:
      apt:
        packages:
        - libgfortran3
  - os: osx
    language: shell
    addons:
      homebrew:
        update: true
        packages:
        - python@3.8
        casks:
        - gfortran
    before_cache:
    - brew cleanup
    cache:
      directories:
      - "$HOME/Library/Caches/Homebrew"
    before_install:
    - alias python3="/usr/local/opt/python@3.8/bin/python3"
    - alias pip3="/usr/local/opt/python@3.8/bin/pip3"
install:
- python3 -m pip install -r requirements.txt
- python3 -m pip install -r test-requirements.txt
- python3 -m pip install -v .

script:
- python3 -m pytest

deploy:
  provider: pypi
  skip_existing: true
  user: AWehrhahn
  password:
    secure: WroUri/lUVhUaJyag3dKmAM0vb91nG0n4QvxQ1wIIiXMjpQEtobpqvzhhKIEmh6f++Ox7llD8TBAoOQO9VNh7urlYI7IRKDb9I1H+yFN+ZBfxGD+9kyEXRmeKhaOO2VJ+vHNdbPJe5dhk7N/fu63rjrCbKqVm3RYpufiZnIdU7K8i5b+IgvH20++EMKdi/jiiSpYhKx2qnp3c4CJtqEFVLIZaPVrDZ8PyRE12Z2+A6B8nEDfo7Ccb+WYg0XNikxV12UYIj1aq++chLEWcPpn16x6PUgz2JfLMlIejTunY9zL54F49xDY6r5kfK42LlPsHMpr2oTOoctOE+giEYQQl7J+bR65xpYpuovrsdieMJXAXUTKMEvrVKFA5Hbzq7XN/E1DP8I9pEIemE8q/vLFTmze/jJP73C9EJQe/YFkcuuu7pbs4kGMY3AnxRMgsUg2obnw7A1wJL3ufa2JAmZgA3oDs+ZFXtzT6y1XKFAq6HXVp3uXUq4wy7kgPipyGumjsjQC6Y9VibxIy3urD06l8EQZ/raIqAKS+5/0Q3lQroIvpAZ6vpjIk1gY0gECDuHtLI3BK8B0xL+Q6emWzFei/8Za/iXHb70tR6l6Y2qY/awCrTHJeJG5peu8JUfVNVbnPbLo0SSzLlgnlOQfxlyZqjOZSlLX15WfMMqa0XZkRng=
  on:
    tags: true
    repo: AWehrhahn/SME
  skip_cleanup: 'true'
